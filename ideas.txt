Demons of Dex
A roguelike for the unexpanded VIC-20
Copyright (C) 2015 Petri HÃ¤kkinen

You are Eino, a member of the druids.
Your master, the arch druid has become
old and it is time for somebody to replace
him. As a young initiate you are sent to
dungeon Dex, a mysterious labyrinth and
a home to vile creatures. You must enter
the dungeon alone and defeat three demon
lords within. Only then can you achieve
true enlightenment and ascend to become
the next arch druid.

Good luck!

TODO:
- yellow slimes
- slime splitting
- consider to change so that only green enemies can be wounded?
- demon hp = dungeon level/2 ?
- ranged attack for wizards?
- OPT: try to remove end of line and end of basic program zero bytes (would save 2 bytes)
- OPT: replace JMPs with branches
- check that init stairs does not get stuck in infinite loop
- flashing color effect to the end screen ankh (maybe change # char to something else too?)
- different explored color for special levels (green/red/blue)
- improve monster selection, especially for special levels
- poisoned condition (snakes)
- print level numbers when descending and leveling up
- RNG is terrible, same levels can repeat during a play session (only 256 different levels)
	-- $E094: Perform RND. To get RND(1) functionality, enter at $E0BB. It will leave its value in (FAC). 

levels:
- dungeon with 18 levels
- special demon levels at levels 6, 12 and 18
- stairway does not appear before demon is defeated
- special level themes: lava, water, ???
- special items (weapons, etc.) are useful for defeating demons, hidden in levels

special levels:
- 6: demon of worms, worms, staff, altered color scheme
- 12: demon of slime, slimes, cloak, altered color scheme
- 18: demon of time, wizards/stalkers, altered color scheme
- level theme water, stream of water crosses the level (modified drunken walk)
- level theme: darkness, line of sight limited to 1 cell

level generation:
- start with a level filled with walls
- random walker carves tunnels, turns at map edges

tiles:
- FLOOR
- WALL
- DOOR			; reveals next area, when opened, door is removed from the map
- SECRET_DOOR	; wall that can be walked through by player
- WATER			; only player can traverse water (only player can remember contents of cell)
- LAVA			; deals damage
- STAIRS		; descend to level below, one way (no going back to previous level)
- CHEST			; a chest contains a random item but may be trapped
- ARMOR			; brown = leather, green = cloak, grey = plate mail, blue = magic armor
- WEAPON		; dagger, sword, axe 
- ACCESSORY		; rings, amulets

monsters:
- monsters are encoded into screen and color ram (no instance data)
- bosses (only one per level) have health (BOSS_HEALTH var)
- BAT: red 'b'
- RAT: red 'r'
- SNAKE: green 's'  poisons
- ORC: green 'o'
- UNDEAD: white 'z'
- STALKER: white ' ', invisible except for void
- SLIME: green 'S' slimes don't move, they spread to adjacent cells
- WIZARD: purple '@' wizards can teleport and shoot lightning bolts
- DEMON: yellow 'X'
- DRAGON: red 'D'
- WORM white 'w'

- monster flags:
	- MF_TOUGH			= 1	; when a hit would kill the monster, it is wounded instead (turns red)
	- MF_DROP_SCROLL	= 2
	- MF_DROP_POTION	= 4
	- MF_DROP_GOLD		= 8
	- MF_DROP_GEM		= 16
	- MF_DROP_ARMOR		= 32
	- MF_DROP_WEAPON	= 64
	- MF_UNUSED			= 128
- monster stats (stored by type, not per instance):
	- char name[8]
	- byte damage		; how much damage the monster deals
	- byte armor		; how difficult it is to kill the monster
	- byte speed		; how often monster is updated (every nth update)
	- byte flags		; misc flags (special abilities)

monster conditions:
- encoded into color ram
- monster is not considered to have condition if its native color matches with condition color?
	- e.g. snakes are green and therefore don't have poisoned condition
- wounded (red)
- frozen/slowed (cyan), works with all monsters because no monster is cyan normally

player condition:
- poisoned (health bar green)

items:
- scrolls & potions: effect is determined by color ram
- items are picked up by walking over them (message "Found potion.")
- gem: reveals level map when picked up
- gold: increases score when picked up
- usable items:
	- POTION (f1): heals
	- SKULL (f3): destroys all visible creatures (screen shake & sound)
	- SCROLL (f5): magic missile? invisibility?
	- KEY (f7): opens locked door

key items (hidden behind secret doors?):
- cloak: gives extra health? protects against poison?
- staff ('/'): enables cast 'z' command, casts firebolt / icebolt, limited number of charges
  'z' => "dir?"
- ankh (need custom char!): dispels magical barriers? timestop?
- only when possession all three key items can the final demon be killed?

the end:
- void
- mysterious @ appears: well done my child!
- show huge ankh on the screen with final score

status bar:
- displayed at the bottom of the screen:
	HHHHHH P1 S1 S1 K1 ABC
	(H=hearts/half-hearts, P=potions, S=skulls, S=scrolls, K=keys, A=magic weapon, B=magic armor, C=ankh)

level up:
- xp=xp+1 when a monster is killed
- gain level when xp > level*4
- health+1 at level up

animated tiles (update char ram):
- room for 64 characters (including alphabets,numbers,commas etc.), takes 512 bytes at end of ram
- gold twinkle
- water/lava vertical scrolling
- monster animation by mirroring char data (how to efficiently do bit reverse?)
- targetting: update character dynamically (inverse of character below cursor)
